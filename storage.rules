rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Regras para a galeria de imagens
    match /gallery/{allPaths=**} {
      // Qualquer pessoa pode ler as imagens (necessário para exibi-las no site).
      allow read;
      // Apenas usuários autenticados (administradores) podem enviar.
      // A segurança real é feita na aplicação, que só mostra a página para admins.
      allow write: if request.auth != null;
    }

    // Regras para fotos de referência de agendamentos
    match /appointments/{fileName} {
       // Qualquer pessoa pode ler as imagens (o admin precisa ver a referência).
      allow read;
      // Permite que um usuário autenticado escreva um arquivo se o nome do arquivo começar com seu UID.
      // Isso impede que um usuário envie arquivos em nome de outro.
      allow write: if request.auth != null && request.auth.uid == fileName.split('_')[0];
    }
  }
}
